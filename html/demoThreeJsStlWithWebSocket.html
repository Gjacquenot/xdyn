<html>
    <head>
        <meta charset="UTF-8" />
        <title>Three.js with WebSocket</title>
        <link rel="stylesheet" href="css/buttons.css"/>
    </head>
    <body>
        <script type="text/javascript">
        var ws;
        var url;
        function connect() {
            url = document.getElementById("server_url").value;
            if ("WebSocket" in window) {
                ws = new WebSocket(url);
            } else if ("MozWebSocket" in window) {
                ws = new MozWebSocket(url);
            } else {
                document.getElementById("messages").innerHTML += "This Browser does not support WebSockets<br />";
                return;
            }
            ws.onopen = function(e) {
                document.getElementById("messages").innerHTML += "Client: A connection to "+ws.url+" has been opened.<br />";
                document.getElementById("server_url").disabled = true;
                document.getElementById("toggle_connect").innerHTML = "Disconnect";
            };
            
            ws.onerror = function(e) {
                document.getElementById("messages").innerHTML += "Client: An error occurred, see console log for more details.<br />";
                console.log(e);
            };
            
            ws.onclose = function(e) {
                document.getElementById("messages").innerHTML += "Client: The connection to "+url+" was closed. ["+e.code+(e.reason != "" ? ","+e.reason : "")+"]<br />";
                cleanup_disconnect();
            };
            
            ws.onmessage = function(e) {
                document.getElementById("messages").innerHTML = "Server: "+e.data+"<br/>";
                console.log(typeof(e.data));
                if (typeof(e.data)==="string")
                {
                    var obj = JSON && JSON.parse(e.data) || $.parseJSON(e.data);
                    render_(0.05*obj.count,0,0);
                    //render_(0.05*parseInt(e.data.split(" ")[2]),0,0);
                }
                else
                {
                    //var bytes = new Float64Array(buffer);
                }
            };
        }

        function disconnect() {
            ws.close();
            cleanup_disconnect();
        }

        function cleanup_disconnect() {
            document.getElementById("server_url").disabled = false;
            document.getElementById("toggle_connect").innerHTML = "Connect";
            document.getElementById("messages").innerHTML += "Disconnected";
        }

        function toggle_connect() {
            if (document.getElementById("server_url").disabled === false) {
                connect();
            } else {
                disconnect();
            }
        }
        </script>
        <div id="controls">
            <div id="server">
                <input type="text" name="server_url" id="server_url" value="ws://localhost:9002" /><br />
                <button id="toggle_connect" onclick="toggle_connect();">Connect</button>
            </div>
        </div>
        <div id="messages"></div>
        <button class="myButton"
            onclick="reset()">RESET</button>
                <form method="post" onsubmit="f(document.getElementById('xval').value,document.getElementById('yval').value,document.getElementById('zval').value);return false;">
                X<input type="text" id="xval" value=0>
                Y<input type="text" id="yval" value=0>
                Z<input type="text" id="zval" value=0>
                <input type="submit" class "myButton" value="Submit">
                </form>

        <script src="js/three.min.js"></script>
        <script src="js/STLLoader.js"></script>
        <script src="js/Detector.js"></script>
        <script src="js/test.js"></script>
    </body>
</html>
